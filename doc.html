<!DOCTYPE html>
<html>
	<head>
		<title>Documentation</title>
		<link rel="stylesheet" href="bootstrap.min.css">
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					<h1>RDDB A-la Kadar Documentation</h1>
					<h2>Basic Usage</h2>
					<p>See <a href="example.php">example.php</a></p>
					<h2>Main Driver Functions</h2>
					<ul>
						<li>
							<h4>$db->error()</h4>
							<blockquote>Get last error message</blockquote>
						</li>
						<li>
							<h4>$db->ecode()</h4>
							<blockquote>Get last error code</blockquote>
						</li>
						<li>
							<h4>$db->simple_query($sql)</h4>
							<blockquote>Execute $sql and return true or false</blockquote>
						</li>
						<li>
							<h4>$db->query($sql)</h4>
							<blockquote>
								Execute $sql and return corresponding result class depending on the query executed or false if error.
								<ul>
									<li>Return mysqli_db_list_result for default data grabbing query</li>
									<li>Return mysqli_db_insert_result for insert query</li>
									<li>Return mysqli_db_write_result for modification query</li>
								</ul>
							</blockquote>
						</li>
						<li>
							<h4>$db->fetch_query($sql, $type = rddb::FETCH_OBJECT)</h4>
							<blockquote>Execute data grabbing query $sql, and automatically return fetched arrays, using 2nd argument to determine row type</blockquote>
						</li>
						<li>
							<h4>$db->select($table, $select, $where, $join, $order, $limit, $offset, $group, $having)</h4>
							<blockquote>
								<p>Generate query string using the given parameters. Parameters can be put in one big array</p>
								<p>Example:</p>
								<pre>$params = [
	'select' => ['id', 'name'],
	'join' => [
		['othertable', 'othertable.id' => 'table.id', 'left']
	]
	'where' => [
		'email' => $email
	],
	'limit' => 20,
	'start' => 0
];
$db->select('table', $params);
// Will generate something like: SELECT `id`, `name` FROM `table` LEFT JOIN `othertable` ON `othertable`.`id` = `table`.`id` WHERE `email` = 'test@example.com' LIMIT 0,20</pre>
							</blockquote>
						</li>
						<li>
							<h4>$db->get($table, $select, $where, $join, $order, $limit, $offset, $group, $having)</h4>
							<blockquote>Get list data from $table and return mysqli_db_list_result class, or false if error. The query generated using the same method as $db->select(), see above</blockquote>
						</li>
						<li>
							<h4>$db->fetch_get($table, $select, $where, $join, $order, $limit, $offset, $group, $having)</h4>
							<blockquote>Same as $db->get() but return the result same as $db->fetch_query()</blockquote>
						</li>
						<li>
							<h4>$db->row($table, $type, $select, $where, $join, $order, $limit, $offset, $group, $having)</h4>
							<blockquote>Get the first row of the result and return it as $type, rddb::FETCH_OBJECT is the default</blockquote>
						</li>
						<li>
							<h4>$db->count_row($table, $where, $join, $group, $having) or $db->count($table, $where, $join, $group, $having)</h4>
							<blockquote>Get total row generated by the given query parameters</blockquote>
						</li>
						<li>
							<h4>$db->insert($table, $data)</h4>
							<blockquote>
								<p>Insert $data into $table. $data should be an array with the keys as the fields and values as inserted values</p>
								<p>Example</p>
								<pre>$db->insert('test', [
	'field' => 'value',
	'field2' => 'value2'
]);</pre>
								<p>NULL will be treated as NULL, a single element array as value will be treated as raw data/unescaped, only used when value use internal mysql function like ['NOW()']</p>
							</blockquote>
						</li>
						<li>
							<h4>$db->update($table, $data, $where)</h4>
							<blockquote>Update $table using $data on $where condition. $where can be an array of conditions</blockquote>
						</li>
						<li>
							<h4>$db->insert_update($table, $condition, $data)</h4>
							<blockquote>Update $table using $data when $condition are met, or insert otherwise</blockquote>
						</li>
						<li>
							<h4>$db->delete($table, $where, $limit)</h4>
							<blockquote>Delete from $table using condition $where, if $limit specified, only delete that much row</blockquote>
						</li>
						<li>
							<h4>$db->truncate($table)</h4>
							<blockquote>Truncate $table. If arrays is given, well, truncate them 1 by 1</blockquote>
						</li>
						<li>
							<h4>$db->protect_key($key) or rddb::_k($key, $db)</h4>
							<blockquote>
								<p>Protect key string by wraping them in key protector. Example if using mysqli: table => `table`</p>
								<p>When using _k method to protect key, $db var is optional, the method will automatically get the first connection available to protect the key</p>
							</blockquote>
						</li>
						<li>
							<h4>$db->escape($string) or rddb::_x($string, $db)</h4>
							<blockquote>Smart Check $string, Escape if detected as string by wrapping them using corresponding quote, Convert to 1 or 0 if boolean detected, NULL will be given if $string is exactly NULL or 'NULL', otherwise, return the $string as it is</blockquote>
						</li>
						<li>
							<h4>$db->close()</h4>
							<blockquote>Close current connection</blockquote>
						</li>
						<li>
							<h4>$db->list_tables()</h4>
							<blockquote>Get array of tables</blockquote>
						</li>
						<li>
							<h4>$db->table_exists($table)</h4>
							<blockquote>Check if $table is exist. Can use '#__' to automatically add table prefix specified in config.php. Example: prefix: 't_' then '#__table' will be translated to t_table</blockquote>
						</li>
						<li>
							<h4>$db->list_fields($table)</h4>
							<blockquote>Get array of fields for $table</blockquote>
						</li>
						<li>
							<h4>$db->field_exists($table, $field)</h4>
							<blockquote>Check if $field exists in $table</blockquote>
						</li>
					</ul>
					<h2>Building $where</h2>
					<ul>
						<li>
							<h4>If $where is string</h4>
							<blockquote>Will be treated as is, unprotected, unescaped</blockquote>
						</li>
						<li>
							<h4>['field' => 'value']</h4>
							<blockquote>
								<code>`field` = 'value'</code>
								<p>If value contain character '(' it will not be escaped. To force value to be treated as string, you can manually escape the value, or use this: <code>['field' => new db_string_value('value')]</code></p>
							</blockquote>
						</li>
						<li>
							<h4>['field' => '(&gt;|&lt;|=|&gt;=|&lt;=|<&gt;|!=|&lt;=&gt;|LIKE|IN|IS|REGEXP|NOT LIKE|IS NOT|NOT IN) value']</h4>
							<blockquote>
								<code>`field` (&gt;|&lt;|=|&gt;=|&lt;=|<&gt;|!=|&lt;=&gt;|LIKE|IN|IS|REGEXP|NOT LIKE|IS NOT|NOT IN) 'value'</code>
							</blockquote>
						</li>
						<li>
							<h4>['(OR|NOT|AND) field' => 'value']</h4>
							<blockquote>
								<pre>(OR|NOT|AND) `field` = 'value'</pre>
								<p>NOT is used as an alternative to !=</p>
							</blockquote>
						</li>
						<li>
							<h4>['(NOT) field' => NULL]</h4>
							<blockquote>
								<pre>(NOT) `field` IS NULL</pre>
								<p>NOT is used as an alternative to IS NOT</p>
							</blockquote>
						</li>
						<li>
							<h4>['(NOT) field' => ['value1', 'value2', 'value3']]</h4>
							<blockquote>
								<code>(NOT) `field` IN ('value1', 'value2', 'value3')</code>
								<p>NOT in the beginning also is an alternative to NOT IN</p>
							</blockquote>
						</li>
						<li>
							<h4>['(NOT) field' => '%value%']</h4>
							<blockquote>
								<code>(NOT) `field` LIKE '%value%'</code>
								<p>NOT in the beginning also is an alternative to NOT LIKE</p>
							</blockquote>
						</li>
						<li>
							<h4>['field' => ['BETWEEN', 'value1' => 'value2']]</h4>
							<blockquote>
								<code>`field` BETWEEN 'value1' AND 'value2'</code>
							</blockquote>
						</li>
						<li>
							<h4>[['field1' => 'value1', 'field2' => 'value2']]</h4>
							<blockquote>
								<code>AND (`field1` => 'value1' AND `field2` => 'value2')</code>
								<p>Every sub array will also be treated as another where</p>
							</blockquote>
						</li>
						<li>
							<h4>['OR' => ['field1' => 'value1', 'field2' => 'value2']]</h4>
							<blockquote>
								<code>OR (`field1` => 'value1' AND `field2` => 'value2')</code>
							</blockquote>
						</li>
					</ul>
					<h2>$join</h2>
					<ul>
						<li><pre>
[$table_to_join, $join_base_field => $table_base_field, $optional_join_type]
OR
[$table_to_join, $identical_base_field, $optional_join_type]
							</pre></li>
						<li>
							Example:
							<pre>[
	['table2', 'table2.id' => 'maintable.id'],
	['table3', 'table3.id' => 'maintable.id', 'right'],
	['table4', 'id'],
]</pre>
						</li>
						<li>
							Result
							<pre>JOIN `table2` ON `table2`.`id` = `maintable`.`id`
RIGHT JOIN `table3`.`id` ON `table3`.`id` = `maintable`.`id`
JOIN `table4` USING(`id`)</pre>
						</li>
					</ul>
					<h2>Result Functions</h2>
					<h3>Global Result Functions</h3>
					<ul>
						<li>
							<h4>$result->query_string()</h4>
							<blockquote>Return the query executed in this result</blockquote>
						</li>
						<li>
							<h4>$result->free()</h4>
							<blockquote>Free the result from memory</blockquote>
						</li>
					</ul>
					<h3>List Result Functions</h3>
					<ul>
						<li>
							<h4>$result->fetch($row_type = rddb::FETCH_OBJECT)</h4>
							<blockquote>
								<p>Fetch all data into array. Row type depends on the $row_type parameter given</p>
								<ul>
									<li>rddb::FETCH_OBJECT - Default, row is a stdClass object</li>
									<li>rddb::FETCH_ASSOC - Each row is an associative array with key is the field</li>
									<li>rddb::FETCH_NUM - Each row is an numerative array with key is the order of the field on SELECT statement, starting from 0</li>
									<li>rddb::FETCH_BOTH - Combination of ASSOC and NUM</li>
								</ul>
							</blockquote>
						</li>
						<li>
							<h4>$result->row($row_type)</h4>
							<blockquote>Get the first for of the result. The result also automatically save all fetched rows</blockquote>
						</li>
						<li>
							<h4>$result->num_rows()</h4>
							<blockquote>Get total rows returned from the result, affected by LIMIT</blockquote>
						</li>
						<li>
							<h4>$result->num_fields()</h4>
							<blockquote>Get total fields returned from the result</blockquote>
						</li>
					</ul>
					<h3>Insert Result Functions</h3>
					<ul>
						<li>
							<h4>$result->insert_id()</h4>
							<blockquote>Get last inserted row ID</blockquote>
						</li>
					</ul>
					<h3>Write Result Functions</h3>
					<ul>
						<li>
							<h4>$result->affected_rows()</h4>
							<blockquote>Get the number of affected rows by the query, also available in insert result</blockquote>
						</li>
					</ul>
					<hr />
					<h1>RDModel</h1>
					<h2>Basic Usage</h2>
					<p>See mymodel.php and <a href="example2.php">example2.php</a></p>
					<h2>Setup Vars</h2>
					<ul>
						<li>
							<h4>public $_table</h4>
							<blockquote>Required variable. Contain string of table name representated in the model class</blockquote>
						</li>
						<li>
							<h4>public $_primary_key</h4>
							<blockquote>Optional variable but better if declared. Contain string of table primary key field</blockquote>
						</li>
						<li>
							<h4>public $_fields</h4>
							<blockquote>
								<p>Optional variable but better if declared. Contain array of strings of fields on the table</p>
								<p>Example:</p>
								<pre>['id', 'name', 'test']</pre>
								<p>populate() method by default use this list for populating the data from datasource</p>
							</blockquote>
						</li>
						<li>
							<h4>public $_populated</h4>
							<blockquote>
								<p>Optional variable. Contain array of strings of fields on the table that will be populated when populate() method is called</p>
								<p>Only declared if you have some data that should be set manually</p>
								<p>Example:</p>
								<pre>['id', 'name']</pre>
							</blockquote>
						</li>
						<li>
							<h4>public $_populate_null_on_empty</h4>
							<blockquote>Optional variable. Set to false default. If true, all empty string will be NULL-ed when populated</blockquote>
						</li>
						<li>
							<h4>public $_validation</h4>
							<blockquote>
								<p>Optional variable. Contain array of validator item used in rdvalidator class. Used when validate() method is called</p>
								<pre>[
	'postfield' => [
		['validation_rule', 'validation_param', 'error message', $optional_object]
	]
]</pre>
								<p>If $optional_object specified, that variable must contain a method named 'validate_{validation_rule}' with at least 2 parameter for $value and $param</p>
								<p>Because of you can't declare a variable as value, $optional_object can only be added later inside another method or manually when calling validate() method</p>
								<p>Example:</p>
								<pre>[
	'name' => [
		['required', true, 'Name is required'],
		['min_length', 2, 'Name should be at least 2 characters']
	]
]</pre>
							</blockquote>
						</li>
						<li>
							<h4>public $_structure</h4>
							<blockquote>
								<p>Optional variable. Used to generate table if not exists and/or automatically fill the $_fields var when not specified before checking directly to the table</p>
								<p>Example:</p>
								<pre>[
	'field' => [
		'name' => 'field',
		'type' => 'INT(11)',
		'value' => NULL,
		'null' => true,
		'auto_increment' => true
	]
]</pre>
							</blockquote>
						</li>
					</ul>
					<h2>Active Records</h2>
					<p>Active record, in my definition is that a record of a table can be created/accessed/modified through a model. In RDModel, you can access/set fields directly from a model just like accessing their public properties. Example:</p>
					<pre>$model->field1 = 'test';
$model->field2 = 'halo';</pre>
					<p>Setting a variable on an 'unloaded' record will treat them as new active record, unless the primary key field value is set then it will be an existing active record</p>
					<p>To load an existing record from a table to be the current active record, use method load($id), where $id is the value of primary key to be loaded as an active record. Once loaded you can access and/or modify the data directly</p>
					<pre>$field1 = $model->field1;</pre>
					<p>New Data Example:</p>
					<pre>$model->field1 = 'test';
$model->field2 = 'value2';
$model->save();</pre>
					<p>Update Data Example:</p>
					<pre>$model->load(1);
$model->field2 = 'halo';
$model->save();</pre>
					<p>Force Insert</p>
					<pre>$model->id = 1;
$model->field1 = '1234';
$model->field2 = 'meow';
$model->save(true);
// OR $model->insert();</pre>
					<p>Update without loading the data</p>
					<pre>$model->field1 = '2345';
$model->update(1);</pre>
					<p>See section below for detail on functions</p>
					<h2>Methods</h2>
					<ul>
						<li>
							<h4>$model->debug($status)</h4>
							<blockquote>Set rddb debug flag</blockquote>
						</li>
						<li>
							<h4>$model->populate($source, $prefix)</h4>
							<blockquote>
								<p>Populate the active record from $source. $source can be a string of 'post' or 'get' corresponding to php global request variables, or array containing key value pair for the data</p>
								<p>When the fields specified in $_populated property, populate will only check those fields not the $_fields property</p>
								<p>Also when $_populate_null_on_empty is set to true, all empty string will be NULL-ed</p>
							</blockquote>
						</li>
						<li>
							<h4>$model->to_array() or $model->__data()</h4>
							<blockquote>Return current active record as array</blockquote>
						</li>
						<li>
							<h4>$model->validate($addition, $populate)</h4>
							<blockquote>Validate postfields using rule specified in <code>$_validation</code>. $addition is collection of rule outside $_validation property. You can pass a custom class validator this way. If $populate set to false, this method will only validate the postfields, you have to populate the data manually</blockquote>
						</li>
						<li>
							<h4>$model->save($force_insert)</h4>
							<blockquote>Save current active record to database. If $force_insert is set to true, the data will always be inserted, even when primary key value specified. Return the saved data as active record</blockquote>
						</li>
						<li>
							<h4>$model->insert($data)</h4>
							<blockquote>Insert $data into table. If $data is empty, the current active record will be inserted. Return last insert ID on success and false on error.</blockquote>
						</li>
						<li>
							<h4>$model->update($id, $data)</h4>
							<blockquote>Update $data from table for matching the primary key $id. Return number of affected rows or false.</blockquote>
						</li>
						<li>
							<h4>$model->update_by($where, $data)</h4>
							<blockquote>Update $data from table for matching condition $where</blockquote>
						</li>
						<li>
							<h4>$model->ready_to_delete($id)</h4>
							<blockquote>Method to be overrided. Check if data with primary key $id is valid to delete. By default only return true.</blockquote>
						</li>
						<li>
							<h4>$model->delete($id)</h4>
							<blockquote>Delete from table with primary key $id. If not specified will get from current active record</blockquote>
						</li>
						<li>
							<h4>$model->delete_by($where)</h4>
							<blockquote>Delete from table with condition matching $where</blockquote>
						</li>
						<li>
							<h4>$model->load($id, $return)</h4>
							<blockquote>Load data with primary key $id as current active record if $return is not specified or set to false. If $return set to true, the data will be returned as an object</blockquote>
						</li>
						<li>
							<h4>$model->unload()</h4>
							<blockquote>Reset current active record. Should be used when before trying to modify/insert multiple data</blockquote>
						</li>
						<li>
							<h4>$model->get($select, $where, $join, $order, $limit, $offset, $group, $having)</h4>
							<blockquote>Same as $db->get() except without $table parameter in the beginning</blockquote>
						</li>
						<li>
							<h4>$model->count($where, $join, $group, $having)</h4>
							<blockquote>Same as $db->count() except without $table parameter in the beginning</blockquote>
						</li>
					</ul>
					<hr />
					<h2>RDValidator</h2>
					<p>A validation class used by RDModel</p>
					<h3>Methods</h3>
					<ul>
						<li>
							<h4>$validator->init($validations, $reset)</h4>
							<blockquote>Add starting validation rule. $validations is the same as $_validation in RDModel. Set $reset to true, to clear current rules before adding $validations</blockquote>
						</li>
						<li>
							<h4>$validator->reset()</h4>
							<blockquote>Clear all validation rules</blockquote>
						</li>
						<li>
							<h4>$validator->add_rule($field, $rule, $message, $param, $customclass)</h4>
							<blockquote>Add new validation rule. See $_validation for more detail</blockquote>
						</li>
						<li>
							<h4>$validator->has_rule($field, $rule, $param, $customclass)</h4>
							<blockquote>Check if $field has validation rule $rule. By default $param is false, and $customclass is NULL</blockquote>
						</li>
						<li>
							<h4>$validator->validate($break)</h4>
							<blockquote>Execute the validation process. If $break set to true, the method will return when the first error occured</blockquote>
						</li>
						<li>
							<h4>$validator->error_summary($title, $html, $class)</h4>
							<blockquote>Generate Error messages with $title. By default, $html is true and will return HTML string of div with class $class, h4 of $title, and unordered list of error message. If $html is set to false, will only return normal text of $title and list of error message</blockquote>
						</li>
						<li>
							<h4>$validator->error_field($field)</h4>
							<blockquote>Check if $field has error</blockquote>
						</li>
					</ul>
					<h3>Provided Validation Rules</h3>
					<ul>
						<li>
							Name: required <br />
							Param: (true|'file') <br />
							Validation: Field must exists and is not empty, if param is 'file', will check $_FILES instead
						</li>
						<li>
							Name: match <br />
							Param: {value to be compared} <br />
							Validation: Field value must match with param value
						</li>
						<li>
							Name: length <br />
							Param: number <br />
							Validation: Field length must be exactly the same as param, if field value is an array, the number of the array will be counted instead
						</li>
						<li>
							Name: min_length<br />
							Param: number <br />
							Validation: Field must have length at least the same as param, if field value is an array, the number of the array will be counted instead
						</li>
						<li>
							Name: max_length<br />
							Param: number <br />
							Validation: Field length must not exceed param, if field value is an array, the number of the array will be counted instead
						</li>
						<li>
							Name: preg_match<br />
							Param: regex pattern <br />
							Validation: Field must match with given pattern
						</li>
						<li>
							Name: equal<br />
							Param: number <br />
							Validation: Field must be the same number as param
						</li>
						<li>
							Name: min<br />
							Param: number <br />
							Validation: Field value must be bigger or equal to param
						</li>
						<li>
							Name: max<br />
							Param: number <br />
							Validation: Field value must be lower or equal to param
						</li>
						<li>
							Name: ip<br />
							Param: true <br />
							Validation: Field value must be a valid IP Address
						</li>
						<li>
							Name: email<br />
							Param: true <br />
							Validation: Field value must be a valid email address
						</li>
						<li>
							Name: url<br />
							Param: true<br />
							Validation: Field value must be a valid URL
						</li>
						<li>
							Name: alphabet<br />
							Param: true <br />
							Validation: Field value can only contain Alphabet
						</li>
						<li>
							Name: number<br />
							Param: true <br />
							Validation: Field value must be a number without decimal
						</li>
						<li>
							Name: decimal<br />
							Param: true <br />
							Validation: Field value must be a valid decimal number
						</li>
						<li>
							Name: alnum<br />
							Param: true <br />
							Validation: Field value can only contain Alphabet and number without decimal
						</li>
						<li>
							Name: alnumplus<br />
							Param: number <br />
							Validation: Field value can only contain Alphabet, number, and these characters _ - .
						</li>
						<li>
							Name: date<br />
							Param: ('iso'|'us'|true) <br />
							Validation: Field value must be in a valid date format as param. 'iso' = YYYY-MM-DD, 'us' = MM/DD/YYYY, true = DD/MM/YYYY
						</li>
						<li>
							Name: datetime<br />
							Param: ('iso'|'us'|true) <br />
							Validation: Field value must be in a valid datetime format as param. 'iso' = YYYY-MM-DD HH:mm[:ss], 'us' = MM/DD/YYYY HH:mm[:ss] (AM|PM), true = DD/MM/YYYY HH:mm[:ss]
						</li>
					</ul>
				</div>
			</div>
		</div>
	</body>
</html>